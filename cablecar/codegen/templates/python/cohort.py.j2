"""
Cohort Definition: {{ study_name }}
Generated by CableCar v2
"""
import pandas as pd
from pathlib import Path

DATA_DIR = Path("{{ data_source }}")

# Load CLIF tables
{% for table in ["patient", "hospitalization", "adt", "vitals", "labs"] %}
{{ table }} = pd.read_csv(DATA_DIR / "{{ table }}.csv")
{% endfor %}

# Define cohort
cohort = hospitalization.copy()
{% for criterion in cohort.get("inclusion", []) %}
cohort = cohort[cohort["{{ criterion.column }}"] {{ criterion.op }} {{ criterion.value }}]
{% endfor %}
{% for criterion in cohort.get("exclusion", []) %}
cohort = cohort[~(cohort["{{ criterion.column }}"] {{ criterion.op }} {{ criterion.value }})]
{% endfor %}

print(f"Final cohort: {len(cohort)} subjects")
