# Cohort Definition: {{ study_name }}
# Generated by CableCar v2

library(tidyverse)

data_dir <- "{{ data_source }}"

# Load CLIF tables
{% for table in ["patient", "hospitalization", "adt", "vitals", "labs"] %}
{{ table }} <- read_csv(file.path(data_dir, "{{ table }}.csv"))
{% endfor %}

# Define cohort
cohort <- hospitalization
{% for criterion in cohort.get("inclusion", []) %}
cohort <- cohort %>% filter({{ criterion.column }} {{ criterion.op }} {{ criterion.value }})
{% endfor %}

cat(sprintf("Final cohort: %d subjects\n", nrow(cohort)))
